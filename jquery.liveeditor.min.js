(function(e,t,n,r){function c(){E(e(this))}function h(){T(this)}function p(){var t=e(this).unbind("focus",p).select();var n=t.parent().unbind("mouseleave",h);var r=n.data(i);if(n[0]===r._focusedContainer){return true}if(r._focusedContainer){if(!x(r._focusedContainer))return false}r._focusedContainer=n[0];t.keydown(d);if(e.isFunction(r.onEditorFocused)){r.onEditorFocused.call(n,t)}return true}function d(t){var n=t.keyCode||t.which;if(n==13){t.preventDefault();var r=e(this).parent();x(r)}else if(n==27){t.preventDefault();var r=e(this).parent();T(r)}else if(n==9){t.preventDefault();var r=e(this).parent();var s=r.data(i);x(r);var o=t.shiftKey?e(s._selector.get().reverse()):s._selector;var u=null;var a=false;do{o.each(function(){if(a&&v(e(this))){u=e(this);return false}else if(this===r[0]){if(a){a=false;return false}else{a=true}}});if(!a){break}}while(u==null);if(u!==null){E(u).focus()}}}function v(e){return e.data(o)===true}function m(e){if(!v(e)){e.data(o,true).mouseenter(c)}return e}function g(e){if(v(e)){e.data(o,false).unbind("mouseenter",c)}return e}function y(t){var n;var s=t.data(i);if(e.isFunction(s.onGetValue)){n=s.onGetValue.call(t)}if(n===r){n=t.hasClass(s.combobox.css)||t.hasClass(s.checkbox.css)?t.attr("value"):t.text()}return n}function b(t,n,o,u){if(u===r)u=false;var a;var f=t.data(i);if(e.isFunction(f.onSetValue)){var a=f.onSetValue.call(t,n,o,u);if(a===false)return false}if(a===r){if(t.hasClass(f.combobox.css)){t.attr("value",n)}else if(t.hasClass(f.checkbox.css)){t.attr("value",n);if(o===null)o=n==f.checkbox.checked.value?f.checkbox.checked.html:f.checkbox.unchecked.html}if(o===null||o===r)o=n;t.html(o)}t.unbind("mouseleave",h).removeClass(f.editingCss);if(t[0]===f._focusedContainer){f._focusedContainer=null}var l=t.data(s);if(n!=l){if(f.changedCss)t.addClass(f.changedCss)}else{if(f.changedCss)t.removeClass(f.changedCss)}return true}function w(t){var n=t.data(i);if(e.isFunction(n.onChanged)){n.onChanged.call(t)}}function E(t){var n=t.data(i);var o=t.children(0);if(o.data(u)!==r){return o}var f=y(t);if(t.data(s)===r){t.data(s,f)}var o=S(t,f);o.focus(p);o.data(a,t.html());t.html(o).mouseleave(h).addClass(n.editingCss);if(e.isFunction(n.onEditorOpened)){n.onEditorOpened.call(t,o)}return o}function S(t,n){var r;var s=t.data(i);var o=s.onEditorCreating;if(o){r=o(t,n)}if(!r){if(t.hasClass(s.combobox.css)){r=e("<select>").width(t.width()-l);var a=s.onEditorOptions.call(t);switch(e.type(a)){case"string":r.append(e(a));break;default:break}e('option[value="'+n+'"]',r).prop("selected",true)}else if(t.hasClass(s.checkbox.css))r=e('<input type="checkbox"/>').prop("checked",n==s.checkbox.checked.value);else{r=e('<input type="text"/>').width(t.width()-l).val(n)}}r.data(u,n);if(s.editorCss){r.addClass(s.editorCss)}return r}function x(t){var n=e(t);var s=n.children(0);if(!s.length||s.data(u)===r){return true}var o=s.data(u);var a=N(s);var f=C(s);if(!b(n,a,f)){return false}var l=n.data(i);if(o!=a){w(n)}if(e.isFunction(l.onEditorClosed)){l.onEditorClosed.call(n)}return true}function T(t){var n=e(t);var s=n.children(0);if(!s.length||s.data(u)===r){return true}var o=s.data(u);var f=s.data(a);if(!b(n,o,f,true)){return false}var l=n.data(i);if(e.isFunction(l.onEditorClosed)){l.onEditorClosed.call(n)}return true}function N(t){var n;var s=t.parent();var o=s.data(i);if(e.isFunction(o.onEditorGetValue)){n=o.onEditorGetValue.call(t)}if(n===r){if(t.is(":checkbox"))n=t.prop("checked")?o.checkbox.checked.value:o.checkbox.unchecked.value;else if(t.is("select"))n=e("option:selected",t).val();else n=t.val()}return n}function C(t){var n;var s=t.parent();var o=s.data(i);if(e.isFunction(o.onEditorGetValue)){n=o.onEditorGetHtml.call(t)}if(n===r){if(t.is("select"))n=e(":selected",t).text();else n=null}return n}function k(t,n){e(t).data(i,n)}var i="liveeditor-options";var s="liveeditor-old";var o="liveeditor-enabled";var u="liveeditor-original-value";var a="liveeditor-original-html";var f={changedCss:"liveeditor-changed",editingCss:null,editorCss:null,combobox:{css:"combo"},checkbox:{css:"checkbox",checked:{value:"true",html:"X"},unchecked:{value:"false",html:""}},onGetValue:null,onSetValue:null,onChanged:null,onEditorCreating:null,onEditorOptions:function(e){return'<option value=""></option>'},onEditorOpened:null,onEditorFocused:null,onEditorClosed:null};var l=5;e.liveeditor={isEnabled:function(e){return v(e)},enable:function(e){return m(e)},disable:function(e){return g(e)},closeEditor:function(e){e.each(function(){x(this)});return e},get:function(t){var n=[];t.each(function(){var t=y(e(this));n.push(t)});return n.length===1?n[0]:n},serialize:function(t,n){var r=[];t.filter(function(){var t=e(this);return(n||t.is("[name]"))&&t.data(i)}).each(function(){var t=e(this);var i=t.attr("name")||n.eq(t.index()).attr("name");r.push(encodeURIComponent(i)+"="+encodeURIComponent(y(t)))});return r.join("&")},serializeRow:function(t,n){var s=e(t).get(0);var o=[];e("*",t).filter(function(){return e(this).data(i)}).each(function(){var t=e(this);var i=y(t);var u=[];while(t.get(0)!=s){u.push(t.index());t=t.parent();if(t.index()===-1)break}u=u.reverse();t=n;for(var a in u){t=t.children().eq(u[a])}var f=t.attr("name");if(f!==r){o.push(encodeURIComponent(f)+"="+encodeURIComponent(i))}else{}});return o.join("&")},set:function(t,n,i){t.each(function(){var t=e(this);var o=y(t);if(t.data(s)===r){t.data(s,o)}if(b(t,n,i)){var u=t.data(s);if(n!==u){w(t)}}});return t},reset:function(t){t.each(function(){var t=e(this);var n=t.data(s);if(n!==r){var o=y(t);if(o!==n){t.data(s,o);var u=t.data(i);if(u.changedCss)t.removeClass(u.changedCss)}}else{}});return t}};e.fn.liveeditor=function(t){var n=e.extend({},f,t);n._focusedContainer=null;n._selector=this;this.each(function(){k(this,n)});e.liveeditor.enable(this);return this}})(jQuery,window,document)